// <view_dispatcher> -*- C++ -*-

#pragma once

#include <furi/core/common_defines.h>
#include <gui/view_dispatcher.h>

#include <cookie/furi_ptr>
#include <cookie/gui/gui>

namespace cookie {

namespace details::view_dispatcher {
struct allocator {
    FURI_ALWAYS_INLINE ::ViewDispatcher* operator()() const {
        return ::view_dispatcher_alloc();
    }

    FURI_ALWAYS_INLINE ::ViewDispatcher*
        operator()(const Gui& gui, ViewDispatcherType type = ViewDispatcherTypeFullscreen) const {
        ::ViewDispatcher* view_dispatcher = ::view_dispatcher_alloc();
        view_dispatcher_attach_to_gui(view_dispatcher, *gui, type);
        return view_dispatcher;
    }
};

struct deleter {
    FURI_ALWAYS_INLINE void operator()(::ViewDispatcher* p) const {
        ::view_dispatcher_free(p);
    }
};
};

using ViewDispatcher = furi_ptr<
    ::ViewDispatcher,
    details::view_dispatcher::allocator,
    details::view_dispatcher::deleter>;
};
